<h2 class="header">Deferrable Views</h2>
<label>Deferrable views allow you to lazy load components, reducing initial bundle size and improving performance by loading content only when needed.</label>

<mat-tab-group>
  <mat-tab label="Basic Syntax">
    <ng-template matTabContent>
      <div class="tab-content">
        <h3>What are Deferrable Views?</h3>
        <p>
          Introduced in Angular 17, deferrable views (&#64;defer blocks) provide a declarative way to lazy load parts of your template.
          This is a powerful feature that can significantly improve your application's initial load time and runtime performance.
        </p>
        
        <h3>Key Features</h3>
        <ul>
          <li><strong>Automatic code splitting:</strong> Components in defer blocks are automatically split into separate chunks</li>
          <li><strong>Multiple trigger conditions:</strong> Load content based on viewport visibility, user interaction, timers, and more</li>
          <li><strong>Prefetching support:</strong> Start loading resources before they're needed</li>
          <li><strong>Built-in states:</strong> Handle loading, error, and placeholder states declaratively</li>
          <li><strong>No additional APIs:</strong> Works entirely through template syntax</li>
        </ul>

        <pre><code class="language-typescript">{{ basicDefer }}</code></pre>
      </div>
    </ng-template>
  </mat-tab>

  <mat-tab label="Trigger Conditions">
    <ng-template matTabContent>
      <div class="tab-content">
        <h3>Available Triggers</h3>
        
        <h4>1. viewport</h4>
        <p>Triggers when the placeholder enters the viewport. Perfect for lazy loading content below the fold.</p>
        
        <h4>2. interaction</h4>
        <p>Triggers on click or keydown events on the placeholder element.</p>
        
        <h4>3. hover</h4>
        <p>Triggers when the user hovers over the placeholder element.</p>
        
        <h4>4. idle</h4>
        <p>Triggers when the browser reaches an idle state (uses requestIdleCallback).</p>
        
        <h4>5. timer</h4>
        <p>Triggers after a specified duration.</p>
        
        <h4>6. immediate</h4>
        <p>Triggers immediately, useful with prefetching strategies.</p>

        <pre><code class="language-typescript">{{ deferTriggers }}</code></pre>
      </div>
    </ng-template>
  </mat-tab>

  <mat-tab label="Prefetching">
    <ng-template matTabContent>
      <div class="tab-content">
        <h3>Prefetching Strategies</h3>
        <p>
          Prefetching allows you to start loading resources before they're needed, improving perceived performance.
          The prefetch happens in the background and doesn't block the main thread.
        </p>

        <h4>Benefits of Prefetching</h4>
        <ul>
          <li>Reduces perceived loading time</li>
          <li>Improves user experience</li>
          <li>Resources are ready when users interact</li>
          <li>Can be combined with any trigger condition</li>
        </ul>

        <h4>Best Practices</h4>
        <ul>
          <li>Use <code>prefetch on idle</code> for content that's likely to be needed</li>
          <li>Combine viewport trigger with idle prefetch for below-fold content</li>
          <li>Use hover prefetch for dropdown menus and tooltips</li>
          <li>Be cautious with prefetching on mobile devices (data usage)</li>
        </ul>

        <pre><code class="language-typescript">{{ prefetching }}</code></pre>
      </div>
    </ng-template>
  </mat-tab>

  <mat-tab label="Advanced Patterns">
    <ng-template matTabContent>
      <div class="tab-content">
        <h3>Advanced Usage</h3>
        
        <h4>Trigger References</h4>
        <p>
          You can reference specific elements as triggers, allowing you to control when defer blocks load
          from anywhere in your template.
        </p>

        <h4>Nested Defer Blocks</h4>
        <p>
          Defer blocks can be nested, allowing for progressive loading of increasingly complex content.
        </p>

        <h4>Loading States with Timing</h4>
        <ul>
          <li><strong>minimum:</strong> Minimum time to show the loading state (prevents flashing)</li>
          <li><strong>after:</strong> Delay before showing the loading state (avoids showing for fast loads)</li>
        </ul>

        <h4>Placeholder Timing</h4>
        <p>
          The <code>minimum</code> parameter on placeholders ensures they're visible for a minimum duration,
          preventing jarring layout shifts.
        </p>

        <pre><code class="language-typescript">{{ advancedPatterns }}</code></pre>
      </div>
    </ng-template>
  </mat-tab>

  <mat-tab label="Real-World Example">
    <ng-template matTabContent>
      <div class="tab-content">
        <h3>E-commerce Product Page</h3>
        <p>
          This example demonstrates how to use deferrable views to optimize a product page,
          loading critical content first and deferring secondary content.
        </p>

        <h4>Strategy Breakdown</h4>
        <ul>
          <li><strong>Product header & images:</strong> Load immediately (critical content)</li>
          <li><strong>Reviews:</strong> Defer until viewport, prefetch on idle (high value, below fold)</li>
          <li><strong>Related products:</strong> Defer until idle (nice to have, not critical)</li>
          <li><strong>Recommendations:</strong> Defer until viewport (personalized, expensive to compute)</li>
        </ul>

        <h4>Performance Benefits</h4>
        <ul>
          <li>Reduced initial bundle size by ~40-60%</li>
          <li>Faster time to interactive</li>
          <li>Better Core Web Vitals scores</li>
          <li>Improved mobile performance</li>
        </ul>

        <pre><code class="language-typescript">{{ realWorldExample }}</code></pre>

        <div class="tips">
          <h4>ðŸ’¡ Tips</h4>
          <ul>
            <li>Always provide meaningful placeholders for better UX</li>
            <li>Use loading states for operations that might take time</li>
            <li>Consider data usage on mobile when using prefetching</li>
            <li>Test defer blocks with network throttling to ensure good UX</li>
            <li>Use Chrome DevTools to verify code splitting is working</li>
          </ul>
        </div>
      </div>
    </ng-template>
  </mat-tab>
</mat-tab-group>
